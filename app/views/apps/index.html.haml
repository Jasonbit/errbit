- content_for :title, 'Apps'
- content_for :action_bar do
  %span= link_to('Add a New App', new_app_path, :class => 'add') if current_user.admin?

- any_github_repos = @apps.any? {|a| a.github_repo? }
- any_issue_trackers = @apps.any? {|a| a.issue_tracker_configured? }

%table.apps
  %thead
    %tr
      %th Name
      - if any_github_repos
        %th GitHub Repo
      - if any_issue_trackers
        %th Tracker
      %th Last Deploy
      %th Errors
  %tbody
    - @apps.each do |app|
      %tr
        %td.name= link_to app.name, app_path(app)
        - if any_github_repos
          %td.github_repo
            - if app.github_repo?
              = link_to(app.github_repo, app.github_url, :target => '_blank')
        - if any_issue_trackers
          %td.issue_tracker
            - if app.issue_tracker_configured?
              = image_tag("#{app.issue_tracker.class::Label}_create.png")
        %td.deploy
          - if app.last_deploy_at
            - revision = app.deploys.last.short_revision
            = link_to( app.last_deploy_at.to_s(:micro) << (revision.present? ? " (#{revision})" : ""), app_deploys_path(app))
          - else
            n/a
        %td.count
          - if app.problems.count > 0
            - unresolved = @unresolved_counts[app.id] || app.problems.unresolved.count
            = link_to unresolved, app_path(app), :class => (unresolved == 0 ? "resolved" : nil)
          - else
            \-
    - if @apps.none?
      %tr
        %td{:colspan => 3}
          %em
            No apps here.
            = link_to 'Click here to create your first one', new_app_path

